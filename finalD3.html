<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="UTF-8">
    <title>Final Project</title>
    <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
    <style>
        body {
            font-family: 'Trebuchet MS', sans-serif;
            margin: 0;
        }

        #page-container {
            margin: 0 auto;
            max-width: 1200px;
            padding: 20px;
        }

        a {
            text-decoration: none;
            color: #000055;
        }

        h1 {
            font-size: 2em;
            margin-bottom: 0;
        }

        h2 {
            font-size: 1.5em;
            margin-top: 0;
            margin-bottom: 0;
            font-weight: normal;
        }

        h3 {
            font-size: 1.2em;
            margin-top: 0;
            font-weight: lighter;
        }

        #header {
            margin-top: 0px;
            margin-left: 0px;
            margin-right: 0px;
            padding: 10px;
            padding-bottom: 10px;
            padding-left: 50px;
            margin-bottom: 10px;
            background-color: rgb(251, 166, 95);
        }

        .graph {
            margin-top: 20px;
            margin-bottom: 20px;
            padding: 20px;
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 10px;
            font-family: 'Trebuchet MS', sans-serif;
        }

        #comments {
            margin-top: 20px;
            padding: 20px;
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 10px;
            font-family: 'Trebuchet MS', sans-serif;
        }

        td {
            vertical-align: top;
            padding: 10px;
            width: 50%;
        }
    </style>
</head>

<body>
    <div id="header">
        <h1>Final Project: Trends in Migrant Encounters and Border Seizures</h1>
        <h2>Bernadette lastname?? and Dahlia Mihalic</h2>
    </div>
    <div id="page-container">
        <div id="g1">
            <h3>Graph 1: Monthly Encounters By AOR</h3>
            <p>describe graph and insights</p>
            <div id="graph1" class="graph"></div>
        </div>
    </div>
    <script>

        const width = 1200;
        const height = 500;
        const margin = { top: 50, right: 200, bottom: 40, left: 70 };
        const innerWidth = width - margin.left - margin.right;
        const innerHeight = height - margin.top - margin.bottom;

        const svg = d3.select("#graph1").append("svg")
            .attr("width", width)
            .attr("height", height)
            .append('g')
            .attr("transform", `translate(${margin.left}, ${margin.top})`);

        /*Data structure for reference
            Date: 2022-01-01
            AOR_Key: ATLANTA FIELD
            Encounter_Count 1501.0
            Count_of_Event 12.0
            Sum_Qty_(lbs) 6383.96952658546
        */

        //getting and converting the data
        d3.csv("https://web.ics.purdue.edu/~omihalic/CGT%20370/Final370/merged_withoutdupes_final.csv").then(data => {
            data.forEach(d => {
                d.Date = new Date(d.Date);
                d.Encounter_Count = +d.Encounter_Count;
                d.Count_of_Event = +d.Count_of_Event;
                d.Sum_Qty_lbs = +d.Sum_Qty_lbs;
            });


            //TASK LIST: Dahlia
            /*
            Line chart: Total monthly encounters across all AORs 
                Show how total encounters fluctuate over fiscal months and highlight major spikes or seasonal patterns.
            Grouped bar chart: Encounter vs. seizure trends for top AORs
                Compare regional activity - helps reveal which areas experience both high migrant crossings and drug seizures.
            Implement interactivity, tooltips, and animated transitions
            */

            //DAHLIA WORKSPACE
            //graph 1: Monthly Encounters By AOR


            //filter data to exclude 2025
            const AORStateMap = {
                //need to fill this out, calling it a night
            };

            const states = Array.from(new Set(Object.values(AORStateMap))).sort();

            //create dropdown filter for states

            // Create dropdown container
            const stateDropdown = d3.select("#g1")
                .insert("p", "div")
                .attr("class", "state-dropdown")
                .style("margin", "10px 0")
                .style("display", "flex")
                .style("align-items", "center")
                .style("gap", "10px");

            // Add label
            stateDropdown.append("label")
                .attr("for", "stateSelect")
                .style("font-weight", "bold")
                .text("Select State:");

            // Add dropdown
            const selectElement = stateDropdown.append("select")
                .attr("id", "stateSelect")
                .style("padding", "6px 12px")
                .style("font-size", "14px");

            // Populate options
            selectElement.selectAll("option")
                .data(["All", ...states])
                .enter()
                .append("option")
                .attr("value", d => d)
                .text(d => d);

            // Attach change listener
            selectElement.on("change", function () {
                const selectedState = d3.select(this).property("value");
                console.log("State selected:", selectedState);
                drawGraph(selectedState);
            });


            function drawGraph(selectedState = "All") {
                svg.selectAll("*").remove();

                const filteredData = data
                    .filter(d => d.Date.getFullYear() < 2025)
                    .filter(d => {
                        if (selectedState === "All") return true;
                        return AORStateMap[d.AOR_Key] === selectedState;
                    });

                const sortedData = Array.from(d3.group(filteredData, d => d.AOR_Key), ([key, values]) => {
                    return {
                        AOR: key,
                        encounters: values.map(e => ({ Date: e.Date, Encounter_Count: e.Encounter_Count }))
                    };
                });

                const xScale = d3.scaleTime()
                    .domain(d3.extent(filteredData, d => d.Date))
                    .range([0, innerWidth]);
                const yScale = d3.scaleLinear()
                    .domain([0, d3.max(filteredData, d => d.Encounter_Count)])
                    .range([innerHeight, 0]);

                const colorScale = d3.scaleOrdinal(d3.schemeCategory10);

                svg.append("rect")
                    .attr("x", xScale(new Date("2022-12-15")))
                    .attr("y", 0)
                    .attr("width", xScale(new Date("2023-01-01")))
                    .attr("height", innerHeight)
                    .attr("fill", "lightgray")
                    .attr("opacity", 0.5);

                const xAxis = d3.axisBottom(xScale).ticks(d3.timeMonth.every(1)).tickFormat(d3.timeFormat("%b"));
                const yAxis = d3.axisLeft(yScale).ticks(10);

                svg.append("g")
                    .attr("class", "x-axis")
                    .attr("transform", `translate(0, ${innerHeight})`)
                    .call(xAxis);
                svg.append("g")
                    .attr("class", "y-axis")
                    .call(yAxis);

                svg.append("text")
                    .attr("class", "x-axis-label")
                    .attr("x", innerWidth / 2)
                    .attr("y", innerHeight + margin.bottom)
                    .attr("text-anchor", "middle")
                    .text("Date");
                svg.append("text")
                    .attr("class", "y-axis-label")
                    .attr("x", -innerHeight / 2)
                    .attr("y", -margin.left + 15)
                    .attr("text-anchor", "middle")
                    .attr("transform", "rotate(-90)")
                    .text("Monthly Encounters");

                svg.append("text")
                    .attr("class", "title")
                    .attr("x", innerWidth / 2)
                    .attr("y", -margin.top / 2)
                    .attr("text-anchor", "middle")
                    .style("font-size", "1.5em")
                    .text(`Monthly Encounters${selectedState !== "All" ? ` in ${selectedState}` : " Across All AORs"}`);

                const lineGenerator = d3.line()
                    .x(d => xScale(d.Date))
                    .y(d => yScale(d.Encounter_Count));

                svg.selectAll(".line")
                    .data(sortedData)
                    .enter()
                    .append("path")
                    .attr("class", "line")
                    .attr("d", d => lineGenerator(d.encounters))
                    .attr("fill", "none")
                    .attr("stroke", d => colorScale(d.AOR))
                    .attr("stroke-width", 2);

                svg.selectAll(".dot")
                    .data(filteredData)
                    .enter()
                    .append("circle")
                    .attr("class", "dot")
                    .attr("cx", d => xScale(d.Date))
                    .attr("cy", d => yScale(d.Encounter_Count))
                    .attr("r", 3)
                    .attr("fill", d => colorScale(d.AOR_Key))
                    .on("mouseover", function (event, d) {
                        d3.select(this).attr("r", 5).attr("fill", "red");
                        svg.append("text")
                            .attr("class", "tooltip")
                            .attr("x", xScale(d.Date) + 10)
                            .attr("y", yScale(d.Encounter_Count) - 10)
                            .text(`Date: ${d3.timeFormat("%Y-%m-%d")(d.Date)} Encounters: ${d.Encounter_Count}`);
                    })
                    .on("mouseout", function () {
                        d3.select(this).attr("r", 3).attr("fill", d => colorScale(d.AOR_Key));
                        svg.selectAll(".tooltip").remove();
                    });

                const legend = svg.append("g")
                    .attr("class", "legend")
                    .attr("transform", `translate(${innerWidth + 10}, ${-50})`);

                legend.selectAll(".legend-item")
                    .data(sortedData)
                    .enter()
                    .append("g")
                    .attr("class", "legend-item")
                    .attr("transform", (d, i) => `translate(0, ${i * 20})`)
                    .each(function (d) {
                        d3.select(this).append("rect")
                            .attr("x", 0)
                            .attr("y", 0)
                            .attr("width", 18)
                            .attr("height", 18)
                            .attr("fill", colorScale(d.AOR));
                        d3.select(this).append("text")
                            .attr("x", 20)
                            .attr("y", 15)
                            .text(d.AOR);
                    });
            }
            drawGraph();




            //TASK LIST: Bernadette
            /*
            Area Chart (Demographics Over Time)
                Highlight the shift among encountered migrants (fam vs. single adults).
            Origin-Destination Map Chart (Flow Map or Choropleth + Arcs)
                Visualize where migrants are coming from (citizenship) and where they are encountered at the U.S. border.
                Shows the relationship between origin countries and U.S. border sectors.
            Reinforces regional trends — for example, more Central American encounters in Texas sectors.
            Ensure responsiveness and integrate all visualizations into a dashboard layout
            */

            //BERNADETTE WORKSPACE




        });
    </script>
    </div>
</body>


</html>